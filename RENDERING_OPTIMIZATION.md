# 渲染优化和卡住问题解决

## 问题诊断

如果渲染卡住或很慢，可能的原因：

1. **场景太复杂**
   - 284个桩基 + 地形 + 干扰物
   - 高分辨率（5280x3956）
   - 复杂的材质和纹理

2. **渲染设置**
   - 采样数太高
   - 噪声阈值太低
   - GPU利用率不高

## 解决方案

### 方案 1: 使用快速测试脚本（推荐）

```bash
./test_quick.sh
```

这个脚本使用：
- ✅ 2个集群（而不是5个）
- ✅ 20-30个桩基每个集群（而不是50-80个）
- ✅ 1920x1080分辨率（而不是5280x3956）
- ✅ 25采样（而不是50）
- ✅ 0.05噪声阈值（更激进）

### 方案 2: 手动优化参数

```bash
blenderproc run generate_mountainous_solar_site.py output/test \
    --image_index 0 \
    --seed 1000 \
    --use_clusters \
    --num_clusters 2 \
    --min_piles_per_cluster 20 \
    --max_piles_per_cluster 30 \
    --render_width 1920 \
    --render_height 1080 \
    --max_samples 25 \
    --noise_threshold 0.05 \
    --use_gpu
```

### 方案 3: 如果当前进程卡住

1. **检查进程状态**：
   ```bash
   ps aux | grep blender
   ```

2. **等待完成**（284个桩基可能需要3-5分钟）

3. **如果确实卡住，中断并重启**：
   - 按 `Ctrl+C` 中断
   - 使用快速测试脚本重新测试

## 渲染时间参考

| 场景复杂度 | 分辨率 | 采样数 | 预计时间 |
|-----------|--------|--------|---------|
| 快速测试 | 1920x1080 | 25 | 30-60秒 |
| 中等 | 1920x1080 | 50 | 1-2分钟 |
| 标准 | 5280x3956 | 50 | 3-5分钟 |
| 高质量 | 5280x3956 | 100 | 5-10分钟 |

## 优化建议

1. **首次测试**：使用 `test_quick.sh`
2. **验证功能**：确认可以生成图像和标注
3. **逐步增加复杂度**：确认没问题后再增加对象数量
4. **生产环境**：使用批量脚本 `run_parallel.sh`

## 检查渲染进度

如果渲染正在进行，可以：
- 查看系统资源使用：`top` 或 `Activity Monitor`
- 检查GPU使用：`Activity Monitor` > GPU
- 等待完成（不要频繁中断）

---

**最后更新**：2026-01-03
