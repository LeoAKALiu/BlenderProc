# 渐进式测试指南

根据快速测试结果，逐步增加复杂度以验证系统稳定性。

## 📊 测试结果总结

### ✅ 快速测试（已完成）
- **状态**: ✅ 成功
- **参数**: 2集群, 20-30桩基/集群, 1920x1080, 25采样
- **结果**: 44个桩基, 渲染时间3.89秒
- **输出**: 图像和标注文件正常生成

## 🎯 渐进式测试方案

### 阶段 1: 快速测试 ✅（已完成）
```bash
./test_quick.sh
```
- 集群数: 2
- 桩基数: 20-30/集群
- 分辨率: 1920x1080
- 采样数: 25
- **预计时间**: 30-60秒
- **状态**: ✅ 通过

### 阶段 2: 中等复杂度测试
```bash
./test_medium.sh
```
- 集群数: 3
- 桩基数: 40-60/集群（约120-180个桩基）
- 分辨率: 2640x1978（半分辨率）
- 采样数: 50
- **预计时间**: 1-2分钟
- **目的**: 验证中等复杂度场景的稳定性

### 阶段 3: 标准复杂度测试
```bash
./test_standard.sh
```
- 集群数: 5
- 桩基数: 50-80/集群（约250-400个桩基）
- 分辨率: 5280x3956（全分辨率）
- 采样数: 50
- **预计时间**: 3-5分钟
- **目的**: 验证生产环境参数

### 阶段 4: 批量测试（可选）
```bash
./run_parallel.sh 2 10 output/test_batch 4000
```
- 并行数: 2
- 图像数: 10
- **预计时间**: 15-30分钟
- **目的**: 验证批量生成稳定性

## 📈 复杂度对比

| 测试阶段 | 集群数 | 桩基数/集群 | 总桩基 | 分辨率 | 采样数 | 预计时间 |
|---------|--------|------------|--------|--------|--------|---------|
| 快速 | 2 | 20-30 | ~50 | 1920x1080 | 25 | 30-60秒 ✅ |
| 中等 | 3 | 40-60 | ~150 | 2640x1978 | 50 | 1-2分钟 |
| 标准 | 5 | 50-80 | ~300 | 5280x3956 | 50 | 3-5分钟 |
| 批量 | 5 | 50-80 | ~300 | 5280x3956 | 50 | 15-30分钟 |

## 🔍 每个阶段的验证点

### 快速测试验证点 ✅
- [x] 脚本可以运行
- [x] 图像文件生成
- [x] 标注文件生成
- [x] 渲染时间合理（<1分钟）
- [x] 桩基可见

### 中等复杂度验证点
- [ ] 更多桩基（120-180个）正常渲染
- [ ] 半分辨率图像质量可接受
- [ ] 渲染时间在预期内（1-2分钟）
- [ ] 内存使用正常
- [ ] 所有桩基都有标注

### 标准复杂度验证点
- [ ] 大量桩基（250-400个）正常渲染
- [ ] 全分辨率图像质量良好
- [ ] 渲染时间可接受（3-5分钟）
- [ ] 系统资源使用稳定
- [ ] 标注准确性和完整性

### 批量测试验证点
- [ ] 多进程并行运行稳定
- [ ] 没有内存泄漏
- [ ] 所有图像成功生成
- [ ] 没有进程卡住
- [ ] 日志文件完整

## 🚀 执行顺序

### 推荐顺序

1. **快速测试** ✅（已完成）
   ```bash
   ./test_quick.sh
   ```

2. **中等复杂度测试**（下一步）
   ```bash
   ./test_medium.sh
   ```
   如果通过，继续下一步

3. **标准复杂度测试**
   ```bash
   ./test_standard.sh
   ```
   如果通过，可以用于生产

4. **批量测试**（可选）
   ```bash
   ./run_parallel.sh 2 10 output/test_batch 4000
   ```

## ⚠️ 注意事项

### 如果某个阶段失败

1. **检查日志**：
   ```bash
   cat output/test_*/logs/*.log | grep -i error
   ```

2. **降低复杂度**：
   - 减少集群数
   - 减少桩基数
   - 降低分辨率
   - 减少采样数

3. **检查资源**：
   ```bash
   # 检查内存
   top -l 1 | grep PhysMem
   
   # 检查GPU（macOS）
   # Activity Monitor > GPU
   ```

### 性能优化建议

如果渲染太慢：
- 降低 `--max_samples`（25-50）
- 提高 `--noise_threshold`（0.05-0.1）
- 降低分辨率（1920x1080 或 2640x1978）
- 减少对象数量

如果内存不足：
- 减少集群数
- 减少桩基数
- 降低分辨率

## 📝 测试记录模板

```
测试日期: 2026-01-03
测试阶段: [快速/中等/标准/批量]
参数: [列出关键参数]
结果: [通过/失败]
渲染时间: [秒]
桩基数: [数量]
问题: [如有]
```

## 🎯 下一步

根据快速测试的成功，建议：

1. **立即执行**: 中等复杂度测试
   ```bash
   ./test_medium.sh
   ```

2. **如果通过**: 执行标准复杂度测试
   ```bash
   ./test_standard.sh
   ```

3. **如果都通过**: 可以开始生产环境使用
   ```bash
   ./run_parallel.sh 2 20 output/dataset 5000
   ```

---

**最后更新**: 2026-01-03

